<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" crossorigin="anonymous">
    <title>Tic Tac Toe</title>
</head>

<style>
    #app-header {
        background-color: #ccc8c8;
        padding: 20px;
        text-align: center;
        max-width: 100vw;
        width: 100%;
        height: 100px;
    }

    #app-table {
        margin: 30px;
        width: 300px;
        border: solid 1px black;
        border-collapse: collapse;
        margin-left: auto;
        margin-right: auto;
    }

    .tic-tac-toe-cell {
        border: solid 1px black;
        text-align: center;
        height: 150px;
        width: 150px;
        font-size: 85px;
    }

    #app-footer {
        background-color: #ccc8c8;
        text-align: center;
        height: 90px;
        width: 100vw;
    }

    #footer-msg {
        padding-top: 20px;
        font-size: 20px;
        font-style: italic;
    }
</style>

<body>

    <!-- App Header where players are required to insert their nickname -->
    <div id="app-header" class="container text-center">
        <div class="row">
            
            <div id="giocatore-1-container" class="col">
                <label for="input-giocatore-1">Giocatore 1</label>
                <input type="text" id="input-giocatore-1" class="input-giocatore" name="input-giocatore-1" placeholder="Giocatore 1">
            </div>

            <div id="start-btn-container" class="col">
                <button id="start-btn" onclick="startGame();">Start Game</button>
            </div>
            
            <div id="giocatore-2-container" class="col">
                <label for="input-giocatore-2">Giocatore 2</label>
                <input type="text" id="input-giocatore-2" class="input-giocatore" name="input-giocatore-2" placeholder="Giocatore 2">
            </div>

        </div>
    </div>

    <!-- Main App Scaffold -->
    <!-- ----------------------------------------- -->
    <div id="app">
        <table id="app-table">
            <tr>
                <td id="cell-0-0"><input id="c-0-0" data-cell='{"row":0, "col":0}' type="text" class="tic-tac-toe-cell"></td>
                <td id="cell-0-1"><input id="c-0-1" type="text" class="tic-tac-toe-cell"></td>
                <td id="cell-0-2"><input id="c-0-2" type="text" class="tic-tac-toe-cell"></td>
            </tr>
            <tr>
                <td id="cell-1-0"><input id="c-1-0" type="text" class="tic-tac-toe-cell"></td>
                <td id="cell-1-1"><input id="c-1-1" type="text" class="tic-tac-toe-cell"></td>
                <td id="cell-1-2"><input id="c-1-2" type="text" class="tic-tac-toe-cell"></td>
            </tr>
            <tr>
                <td id="cell-2-0"><input id="c-2-0" type="text" class="tic-tac-toe-cell"></td>
                <td id="cell-2-1"><input id="c-2-1" type="text" class="tic-tac-toe-cell"></td>
                <td id="cell-2-2"><input id="c-2-2" type="text" class="tic-tac-toe-cell"></td>
            </tr>
        </table>
    </div>
    <!-- ----------------------------------------- -->


    <!-- ----------------------------------------- -->
    <!-- App Footer - It should be usefull -->
    <footer id="app-footer">
        <p id="footer-msg">
            Esercizio di programmazione web - Tic Tac Toe in plain Javascript
        </p>
    </footer>
    <!-- ----------------------------------------- -->


    <script>
        
        const ticTacToe = new TicTacToe();
        
        function TicTacToe() {
            this.board = [
                [null, null, null],
                [null, null, null],
                [null, null, null]
            ];
            this.turn = 'X';
            this.winner = null;

            this.updateBoard = function(cell, value) {
                this.board[cell.row][cell.col] = cell.value;
            };

            this.changeTurn = function() {
                console.log('change turn');
                if (this.turn === 'X') {
                    this.turn = 'O';
                } else {
                    this.turn = 'X';
                }
                console.log('current turn -> ' + this.turn);
            }

            this.checkWinner = function() {
                console.log('check winner');
                this.winner = _checkWinner(this.board);
                console.log('winner -> ' + this.winner);
            }

            this.checkTurn = function() {  // TODO fix
                console.log('check turn');
                if (this.turn === 'X') {
                    return 'X';
                } else {
                    return 'O';
                }
            }
        }

        function Player(name, symbol) {
            this.name = name;
            this.symbol = symbol;
        }

        // Main
        function startGame(event) {
            const player1name = document.getElementById('input-giocatore-1').value;
            const player2name = document.getElementById('input-giocatore-2').value;
            if (!player1name || !player2name || player1name == '' || player2name == '' || player1name === player2name) {
                error('Inserisci i nomi di entrambi i giocatori prima di iniziare la partita. I nomi devono essere diversi.');
                return;
            } 

            const player1 = new Player(player1name, 'X');
            const player2 = new Player(player2name, 'O');
        }

        function _checkWinner(board) {
            var winner = null;
            var winningCombinations = [
                [0, 0, 0],
                [0, 1, 2],
                [0, 2, 0],
                [1, 0, 1],
                [1, 1, 1],
                [1, 2, 2],
                [2, 0, 2],
                [2, 1, 0]
            ];
            for (var i = 0; i < winningCombinations.length; i++) {
                var [a, b, c] = winningCombinations[i];
                if (board[a][b] && board[a][b] === board[a][c]) {
                    winner = board[a][b];
                }
            }
            return winner;
        }

        function handleCellChange(event) {
            const cell = event.target;
            const _symbol = cell.value;
            console.log(cell.dataset.cell);
            const data = JSON.parse(`{"position": ${cell.dataset.cell} }`);
            console.log(data);
            const symbol = _symbol.toUpperCase();
            if (symbol !== 'X' && symbol !== 'O') {
                alert('Il simbolo deve essere X o O');
                cell.value = null;
                return;
            }
            cell.value = symbol;
            cell.style.color = symbol === 'X' ? 'red' : 'blue';
            ticTacToe.changeTurn();
            ticTacToe.checkWinner();
        }



        function error(error, useAlert = true) {
            console.error(error);
            if (useAlert === true) {
                alert(error);
            }
        }
        
        // Quando la pagina Ã¨ pronta, ci attacco i listener
        window.addEventListener('DOMContentLoaded', (event) => {
            console.log('DOM fully loaded and parsed');
            const ticTacToeCells = Array.from(document.getElementsByClassName('tic-tac-toe-cell'));
            console.log(ticTacToeCells);
            ticTacToeCells.forEach((cell) => {
                cell.addEventListener('input', handleCellChange);
            });
        });
    </script>
</body>
</html>